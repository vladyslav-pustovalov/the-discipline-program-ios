name: Backport master to develop
on:
  push:
    branches:
      - master

jobs:
  create_backport_branches:
    runs-on: ubuntu-latest
    steps:

    - name: Checkout branch
      uses: actions/checkout@v3
      with:
        fetch-depth: 1
        ref: master

    - name: Configure Git
      run: |
          git config user.name "github-actions"
          git config user.email "github-actions@github.com"

    - name: Checkout new branch
      run: |
        git checkout -b "chore/master2develop"

    - name: Push changes
      run: |
        git push -u origin "chore/master2develop"

    - name: Create PR master to develop
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      run: |
        gh pr create \
            --base develop \
            --head "chore/master2develop" \
            --title "chore: master2develop" \
            --body "Backport master to develop"

    - name: Enable automerge PR master to develop
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      run: |
        gh pr merge \
            --auto \
            --merge "chore/master2develop" \
            --subject "chore: master2develop"